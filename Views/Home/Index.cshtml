@model Kenpo.Models.HomeViewModels.IndexViewModel

@section styles {
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css"/>
    <style>
    #loader-bg {
        display: none;
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0px;
        left: 0px;
        background: #000;
        z-index: 1;
    }
    #loader {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        width: 200px;
        height: 200px;
        margin-top: -100px;
        margin-left: -100px;
        text-align: center;
        color: #fff;
        z-index: 2;
    }
    </style>
}

<div id="loader-bg">
  <div id="loader">
    <img src="~/images/img-loading.gif" width="80" height="80" alt="Now Loading..." />
    <p>Now Loading...</p>
  </div>
</div>
<div id="wrap">
    <h1>@Model.Header</h1>
    <table id="availabilities" class="stripe">
        <thead>
        <tr>
            <th>申込対象サービス</th>
            <th>空日一覧</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

@section scripts {
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script>
        var url = "@Url.Action("Index", "Availabilities")"; 
        $.ajax({
            url: url,
            success: function(availabilities) {
                var $table = $("#availabilities");
                for (var i = 0; i < availabilities.length; i++) {
                    var availability = availabilities[i];
                    var $tr = $("<tr>");
                    var $td1 = $("<td>");
                    var $td2 = $("<td>");
                    var $a = $("<a>");
                    $a.attr("href", availability.url);
                    $a.attr("target", "_blank");
                    $a.text(availability.title);
                    $td1.append($a);
                    $tr.append($td1);
                    $innerUl = $("<ul>");
                    for (var j = 0; j < availability.dates.length; j++) {
                        var date = availability.dates[j];
                        var $innerli = $("<li>");
                        var $innerspan = $("<span>");
                        if (date.className) {
                            $innerspan.attr("class", date.className);
                        }
                        $innerspan.text(date.text);
                        $innerli.append($innerspan);
                        $innerUl.append($innerli);
                    }
                    $td2.append($innerUl);
                    $tr.append($td2);
                    $table.append($tr);
                }
                $table.dataTable();
                stopload();
            },
            error: function() {
                alrt("読み込みに失敗しました。リロードしてください。");
                location.reload();
            }
        });

    $(function() {
        var h = $(window).height();
        $('#wrap').css('display','none');
        $('#loader-bg ,#loader').height(h).css('display','block');
    });
    
    function stopload(){
        $('#wrap').css('display','block');
        $('#loader-bg').delay(900).fadeOut(800);
        $('#loader').delay(600).fadeOut(300);
    }
    </script>
}